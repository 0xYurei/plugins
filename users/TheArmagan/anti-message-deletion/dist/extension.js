(function(n,p,E,S){"use strict";function g(r){return r&&typeof r=="object"&&"default"in r?r:{default:r}}var _=g(p),o=g(E);class H{constructor(){this.patches=[]}add(...d){this.patches.push(...d)}remove(d){let[i]=this.patches.splice(this.patches.indexOf(t=>t==d),1);i()}removeAll(){let d=this.patches.splice(0,this.patches.length);for(let i=0;i<d.length;i++)d[i]()}}var c=new H,D=()=>S.injectCSS(".amd--edited-message{background-color:#1efa1a1a}.amd--deleted-message{background-color:#f047471a}");let f=[];var M={async load(){c.add(D());function r(t,s){return n.MessageStore.__getLocalVars().rawMessages?.[t]?.[s]}function d(t,s=!0){let a=f.find(e=>e.messageId==t);return a||(a={deleted:!1,messageId:t,edits:[]},s&&f.push(a)),a}function i(t){if(!t?.id?.startsWith("chat-messages-")||t.antiMessageDeletionUpdate)return;let s=t.id.split("-").pop();t.antiMessageDeletionUpdate=()=>{let a=d(s,!1);a.deleted&&t.classList.add("amd--deleted-message"),a.content&&(t.classList.add("amd--edited-message"),o.default.ifExists(t.querySelector(`#message-content-${s}`),e=>{e.innerHTML=`${a.edits.map(l=>n.SimpleMarkdown.markdownToHtml(`${l} *(edited)*`)).join("")}${n.SimpleMarkdown.markdownToHtml(`${a.content} *(original)*`)}`}))},t.antiMessageDeletionUpdate()}for(c.add(_.default.patch('[id*="chat-messages-"]',i));!n.FluxDispatcher?._actionHandlers?._orderedActionHandlers?.MESSAGE_DELETE?.find;)await new o.default.sleep(50);for(c.add((()=>{let t=n.FluxDispatcher._actionHandlers._orderedActionHandlers.MESSAGE_DELETE.find(e=>e.name=="MessageStore"),s=t.actionHandler,a=t.storeDidChange;return t.actionHandler=e=>{!e?.id||e?.author?.bot||(d(e.id,!0).deleted=!0,o.default.ifExists(document.querySelector(`#chat-messages-${e?.id}`),i))},t.storeDidChange=()=>{},()=>{f=[];let e=n.FluxDispatcher._actionHandlers._orderedActionHandlers.MESSAGE_DELETE.find(l=>l.name=="MessageStore");e.actionHandler=s,e.storeDidChange=a}})());!n.FluxDispatcher?._actionHandlers?._orderedActionHandlers?.MESSAGE_UPDATE?.find;)await new o.default.sleep(50);c.add((()=>{let t=n.FluxDispatcher._actionHandlers._orderedActionHandlers.MESSAGE_UPDATE.find(e=>e.name=="MessageStore"),s=t.actionHandler,a=t.storeDidChange;return t.actionHandler=function(e){if(!e?.message?.id||e?.message?.author?.bot)return;if(e.message.content){let h=r(e.message.channel_id,e.message.id);if(h){let u=d(h.id,!0);u.edits.length||(u.content=h.content),u.content!=e.message.content&&u.edits.push(e.message.content)}}let l=s.call(this,e);return o.default.ifExists(document.querySelector(`#chat-messages-${e.message.id}`),i),l},()=>{let e=n.FluxDispatcher._actionHandlers._orderedActionHandlers.MESSAGE_DELETE.find(l=>l.name=="MessageStore");e.actionHandler=s,e.storeDidChange=a}})())},unload(){c.removeAll()}};return M})(acord.modules.common,acord.dom,acord.utils,acord.patcher);
