(function(p,d,i,c,h){"use strict";function f(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var g=f(p),b=f(h);class y{constructor(){this.patches=[]}add(...e){this.patches.push(...e)}remove(e){let[a]=this.patches.splice(this.patches.indexOf(l=>l==e),1);a()}removeAll(){let e=this.patches.splice(0,this.patches.length);for(let a=0;a<e.length;a++)e[a]()}}var u=new y;let r=!1;async function n(){if(r)return setTimeout(n,125);r=!0;let t=d.NotificationSettingsStore.getState(),e=[];t.disabledSounds.includes("mute")||e.push("mute"),t.disabledSounds.includes("unmute")||e.push("unmute"),t.disabledSounds.push(...e),await d.MediaEngineActions.toggleSelfMute(),await b.default.sleep(100),await d.MediaEngineActions.toggleSelfMute(),t.disabledSounds=t.disabledSounds.filter(a=>!e.includes(a)),r=!1}var M={load(){let t=d.GatewayConnectionStore.getSocket(),e={selfMute:!1,selfDeaf:!1,selfVideo:!1},a=Object.keys(e);u.add(g.default.before("voiceStateUpdate",t,l=>{for(let o=0;o<a.length;o++){const s=a[o];l[0][s]=e[s]||l[0][s]}return l})),u.add(i.contextMenus.patch("audio-device-context",(l,o)=>{let s=l?.props?.children?.props?.children;!Array.isArray(s)||(s.push(i.contextMenus.build.item({type:"separator"})),o.renderInputDevices?s.push(i.contextMenus.build.item({type:"toggle",label:c.i18n.format("FAKE_MUTE"),checked:e.selfMute,async action(){e.selfMute=!e.selfMute,n()}})):s.push(i.contextMenus.build.item({type:"toggle",label:c.i18n.format("FAKE_DEAF"),checked:e.selfDeaf,async action(){e.selfDeaf=!e.selfDeaf,n()}}),i.contextMenus.build.item({type:"toggle",label:c.i18n.format("FAKE_CAMERA"),checked:e.selfVideo,async action(){e.selfVideo=!e.selfVideo,n()}})))}))},unload(){u.removeAll(),n()}};return M})(acord.patcher,acord.modules.common,acord.ui,acord.extension,acord.utils);
