(function(S,y,p,N,O,A){"use strict";function h(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function _(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(a){if(a!=="default"){var n=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,n.get?n:{enumerable:!0,get:function(){return e[a]}})}}),t.default=e,Object.freeze(t)}var b=_(S),D=h(y),w=h(O),E=h(A);class k{constructor(){this.patches=[]}add(...t){this.patches.push(...t)}remove(t){let[a]=this.patches.splice(this.patches.indexOf(n=>n==t),1);a()}removeAll(){let t=this.patches.splice(0,this.patches.length);for(let a=0;a<t.length;a++)t[a]()}}var f=new k,L=()=>N.injectCSS(".sb--modal-root{display:flex;flex-direction:column}.sb--modal-root .sb--modal-header{display:flex;align-items:center;justify-content:space-between;padding:16px}.sb--modal-root .sb--modal-header .title{font-size:28px;font-weight:600;color:#efefef}.sb--modal-root .sb--modal-header .sb--modal-close{width:24px;height:24px;cursor:pointer}.sb--modal-root .sb--modal-header .sb--modal-close svg{width:24px;height:24px}.sb--modal-root .sb--modal-content{padding:0 16px 16px;display:flex;flex-direction:column;justify-content:space-between;height:100%}.sb--modal-root .sb--modal-content .disabled{opacity:.25;pointer-events:none}.sb--modal-root .sb--modal-content>.top{display:flex;flex-direction:column}.sb--modal-root .sb--modal-content>.top>.content{width:100%;display:flex;flex-wrap:wrap;align-items:center;justify-content:flex-start;gap:8px}.sb--modal-root .sb--modal-content>.top>.content .item{width:120px;max-width:120px;padding:8px;background-color:#00000040;color:#fff;display:flex;align-items:center;justify-content:center;border-radius:8px;cursor:pointer}.sb--modal-root .sb--modal-content>.top>.content .item .text{display:flex;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;width:112px;text-align:center}.sb--modal-root .sb--modal-content>.controls-container{width:100%;display:flex;align-items:center;justify-content:center;margin-top:8px}.sb--modal-root .sb--modal-content>.controls-container .controls{display:flex;gap:8px;padding:8px;border-radius:8px;background-color:#0000001a;color:#fff;align-items:center;transition:.25s ease-in-out opacity}.sb--modal-root .sb--modal-content>.controls-container .controls .arrow{font-weight:800;font-size:20px;cursor:pointer;color:#f5f5f5d9;transition:.25s ease-in-out opacity}.sb--add-sound{cursor:pointer}.sb--add-sound .exists{color:#faa81a!important}");const{modals:{actions:{show:$},ModalRoot:j},React:r}=D.default,R={DANGER:"#eb3d47",SECONDARY:"#8a8e93",SUCCESS:"#3aa360",PRIMARY:"#5865f2"};function M(e={}){return b.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:"aka--icon aka--close-icon",style:{color:e.color}},b.createElement("path",{d:"M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z",fill:"currentColor"}))}const g=28;function B({names:e,table:t,playSound:a,e:n}){const[s,c]=r.useState({page:0,names:[]});async function i(o=0){let d=e.slice(o*g,o*g+g);c({page:o,names:d})}return r.useEffect(()=>{i(0)},[]),r.createElement(j,{transitionState:n.transitionState,size:"medium",className:"sb--modal-root"},r.createElement("div",{className:"sb--modal-header"},r.createElement("div",{className:"title"},p.i18n.format("SOUND_BOARD")),r.createElement("div",{onClick:n.onClose,className:"sb--modal-close"},r.createElement(M,{color:R.SECONDARY}))),r.createElement("div",{className:"sb--modal-content"},r.createElement("div",{className:"top"},r.createElement("div",{className:"content"},s.names.map(o=>r.createElement("div",{className:"item",onClick:()=>{t[o]&&a(t[o].src,t[o].volume,{begin:t[o].begin,end:t[o].begin+1e3},t[o].end)}},r.createElement("div",{className:"text","acord--tooltip-content":`${o} (${p.i18n.format("VOLUME",~~(t[o]?.volume*100))})`},o))))),r.createElement("div",{className:"controls-container"},r.createElement("div",{className:"controls"},r.createElement("div",{className:`back ${s.page==0?"disabled":""} arrow`,onClick:()=>{i(s.page-1,s.type)}},"<<"),r.createElement("div",{className:"page"},s.page+1),r.createElement("div",{className:"next arrow",onClick:()=>{i(s.page+1,s.type)}},">>")))))}let l={audioContext:null,table:{},buffCache:{},last:""};function P(e,t,a){let n=e.numberOfChannels,s=e.sampleRate;t=t/1e3,a=a/1e3,a>e.duration&&(a=e.duration);let c=s*t,i=s*a,o=Math.max(i-c,0);if(!o)throw"No audio left.";let d=l.audioContext.createBuffer(n,o,s),m=new Float32Array(o),v=0;for(let u=0;u<n;u++)e.copyFromChannel(m,u,c),d.copyToChannel(m,u,v);return d}async function C(e,t=.5,a={begin:0,end:1e3},n=1/0){if(n&&a.end>n)return;let s=[...y.MediaEngineStore.getMediaEngine().connections].filter(o=>o.context=="default"),c=l.buffCache[`${e}`]||await l.audioContext.decodeAudioData(await(await fetch(`https://api.codetabs.com/v1/proxy/?quest=${e}`)).arrayBuffer());l.buffCache[`${e}`]||(l.buffCache[`${e}`]=c);let i=`${Math.random()}`;try{let o=P(c,a.begin,a.end);l.last=i,s[0].startSamplesPlayback(o,t,(d,m)=>{l.last==i&&setTimeout(()=>{C(e,t,{begin:a.end,end:a.end+1e3},n)},0)}),s.slice(1).forEach(d=>{d.startSamplesPlayback(o,t,()=>{})})}catch{}}function U(e){return e=e.trim(),e?Object.fromEntries(e.split(`
`).map(t=>{let a=t.trim().split(";"),n=(Number(a[3])||0)==0?0:Number(a[3])*1e3;return a.length<2?null:[a[0],{src:a[1],volume:Number(a[2])??1,begin:n,end:(Number(a[3])||0)==0?null:n+Number(a[4])*1e3}]}).filter(t=>t)):{}}function x(e){let t=e||p.persist.ghost?.settings?.sounds||"";l.buffCache={},l.table=U(t)}function I(e=""){return e.split(/\?|#/)[0].split(".").pop().toLowerCase()}var T={load(){f.add(L()),l.audioContext=new AudioContext,x(),f.add((()=>{function n(s){s.ctrlKey&&s.code=="KeyB"&&$(c=>b.createElement(B,{e:c,playSound:C,names:Object.keys(l.table),table:l.table}))}return window.addEventListener("keyup",n),()=>{window.removeEventListener("keyup",n)}})());const e=E.default.findByProps("metadataDownload","wrapper"),t=E.default.findByProps("anchor","anchorUnderlineOnHover"),a=["mp3","wav","ogg","m4a"];f.add(w.default.patch('[class*="anchor-"][class*="anchorUnderlineOnHover-"][class*="metadataDownload-"]',n=>{let s=n.getAttribute("href");if(!a.includes(I(s)))return;let c=n.parentElement,i=`${s.split("/").pop().split(".").slice(0,-1).join(".")}_${s.split("/")[5]}`,o=w.default.parseHTML(`
                        <div class="${t.anchor} ${t.anchorUnderlineOnHover} ${e.metadataDownload} sb--add-sound">
                            <svg class="${e.metadataIcon}" viewBox="0 0 24 24" width="24" height="24">
                                <path fill="currentColor" d="M12.5,17.6l3.6,2.2a1,1,0,0,0,1.5-1.1l-1-4.1a1,1,0,0,1,.3-1l3.2-2.8A1,1,0,0,0,19.5,9l-4.2-.4a.87.87,0,0,1-.8-.6L12.9,4.1a1.05,1.05,0,0,0-1.9,0l-1.6,4a1,1,0,0,1-.8.6L4.4,9a1.06,1.06,0,0,0-.6,1.8L7,13.6a.91.91,0,0,1,.3,1l-1,4.1a1,1,0,0,0,1.5,1.1l3.6-2.2A1.08,1.08,0,0,1,12.5,17.6Z"></path>
                            </svg>
                        </div>
                    `),d=o.querySelector("svg");function m(){!!l.table[i]?(o.setAttribute("acord--tooltip-content",p.i18n.format("REMOVE_FROM_SOUNDBOARD")),d.classList.add("exists")):(d.classList.remove("exists"),o.setAttribute("acord--tooltip-content",p.i18n.format("ADD_TO_SOUNDBOARD")))}o.onclick=()=>{if(!!!l.table[i])p.persist.store.settings.sounds=`${p.persist.ghost?.settings?.sounds||""}
${i};${s};1`.trim();else{let u=(p.persist.ghost?.settings?.sounds||"").split(`
`),z=u.findIndex(F=>F.trim().split(";")[0]==i);u.splice(z,1),p.persist.store.settings.sounds=u.join(`
`)}x(),m()},m(),c.insertBefore(o,n)}))},async unload(){f.removeAll(),l.audioContext.close(),l.audioContext=null,l.table={},l.buffCache={},l.last=""},settings:{data:[{type:"textarea",property:"sounds",value:"",placeholder:"SoundName;https://discordcdnlink;0.5",name:"Sounds",description:"Each line is a new sound. Format: SoundName;SoundLink;Volume",rows:9}],update(e,t){switch(e){case"sounds":{console.log(t),x(t);break}}}}};return T})(acord.modules.common.React,acord.modules.common,acord.extension,acord.patcher,acord.dom,acord.modules.webpack);
