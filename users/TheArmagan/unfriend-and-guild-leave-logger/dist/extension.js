(function($,c,k,v){"use strict";function D(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var L=D($);class E{constructor(){this.patches=[]}add(...t){this.patches.push(...t)}remove(t){let[n]=this.patches.splice(this.patches.indexOf(r=>r==t),1);n()}removeAll(){let t=this.patches.splice(0,this.patches.length);for(let n=0;n<t.length;n++)t[n]()}}var g=new E,s={},p={},h={};h.isThenable=function(t){return t!=null&&typeof t.then=="function"},h.isArrayLike=function(t){return t!=null&&typeof t.length=="number"&&t.length>=0};const{isArrayLike:M}=h;p.forEach=function(e,t,n){let r=0,a;if(M(e))return a=e.length,{next(){if(r>=a)return[!0,null];const o=t.call(n,e[r],r,e);return r++,[!1,o]}};const i=Object.keys(e);return a=i.length,{next(){if(r>=a)return[!0,null];const o=i[r++],d=t.call(n,e[o],o,e);return[!1,d]}}},p.repeat=function(e,t,n){let r,a,i;return e&&typeof e=="object"?(r=e.start||0,a=e.step||1,i=e.done):(r=0,a=1,i=e),{next(){const o=t.call(n,r);return r+=a,r>=i?[!0,o]:[!1,o]}}},p.until=function(e,t){return{next(){const n=e.call(t);return[!1,n]}}},p.forOf=function(e,t,n){const r=e[Symbol.iterator]();return{next(){const a=r.next();if(a.done)return[!0,null];const i=t.call(n,a.value,e);return[!1,i]}}};var b={},w=(()=>{if(typeof setImmediate=="function")return e=>{setImmediate(e)};if(typeof process=="object"&&typeof process.nextTick=="function")return e=>{process.nextTick(e)};if(typeof MessageChannel=="function"){const e=new MessageChannel;let t={},n=t;return e.port1.onmessage=()=>{t=t.next;const r=t.task;delete t.task,r()},r=>{n=n.next={task:r},e.port2.postMessage(0)}}return e=>{setTimeout(e,0)}})();const{isThenable:O}=h,T=b,x=w,A=1500;var _=function(t,n=0){return new Promise((r,a)=>{let i=0;function o(){const d=Date.now();let m;try{for(;;){const[l,y]=t.next();if(O(y)){y.then(j=>{l?r(j):j===T?r():o()},a);return}if(l){r(y);return}if(y===T){r();return}if(n>0||(m=Date.now()-d,i+=m,i>1e3))break;if(!(m<10))break}}catch(l){a(l);return}if(n>0){const l=Math.min(A,Date.now()-d+n);setTimeout(o,l)}else{const l=Math.min(A,m/3);i=0,l>10?setTimeout(o,l):x(o)}}x(o)})},C="chillout",G="Reduce CPU usage by non-blocking async loop and psychologically speed up in JavaScript",U="5.0.0",P="polygon planet <polygon.planet.aqua@gmail.com>",F={url:"https://github.com/polygonplanet/chillout/issues"},R={"@babel/core":"^7.8.3","@babel/preset-env":"^7.8.3",babelify:"^10.0.0",bannerify:"^1.0.1",browserify:"^16.5.0","es6-shim":"^0.35.5",eslint:"^6.8.0",karma:"^4.4.1","karma-browserify":"^6.1.0","karma-chrome-launcher":"^3.1.0","karma-detect-browsers":"^2.3.3","karma-es6-shim":"^1.0.0","karma-firefox-launcher":"^1.3.0","karma-ie-launcher":"^1.0.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","karma-safari-launcher":"^1.0.0",mocha:"^7.0.0","package-json-versionify":"^1.0.4",pidusage:"1.0.2","power-assert":"^1.6.1","uglify-js":"^3.7.5",uglifyify:"^5.0.2",watchify:"^3.11.1"},z={node:">=8.10.0"},Y=["dist/*","src/*"],q="https://github.com/polygonplanet/chillout",N=["acceleration","async await","asynchronous","cpu use rate","cpu utilization rate","heavy processing","iterate","iteration","lightweight","nextTick","non-blocking","optimization","optimize for loop","performance","promise","reduce cpu usage","setimmediate","waitUntil"],J="MIT",W="src/index.js",X={type:"git",url:"https://github.com/polygonplanet/chillout.git"},B={benchmark:"node benchmark/benchmark",build:"npm run compile && npm run minify",compile:"browserify src/index.js -o dist/chillout.js -s chillout -p [ bannerify --file src/banner.js ] --no-bundle-external --bare",minify:"uglifyjs dist/chillout.js -o dist/chillout.min.js --comments -c -m -b ascii_only=true,beautify=false",test:"./node_modules/.bin/eslint . && npm run build && mocha test/**/*.spec.js --timeout 10000 && karma start karma.conf.js",travis:"npm run build && mocha test/**/*.spec.js --timeout 10000 && karma start karma.conf.js --single-run",watch:"watchify src/index.js -o dist/chillout.js -s chillout -p [ bannerify --file src/banner.js ] --no-bundle-external --bare --poll=200 -v"},H={transform:["babelify","package-json-versionify"]},K={name:C,description:G,version:U,author:P,bugs:F,devDependencies:R,engines:z,files:Y,homepage:q,keywords:N,license:J,main:W,repository:X,scripts:B,browserify:H};const u=p,f=_,{isThenable:Q,isArrayLike:V}=h,Z=w,ee=b;s.version=K.version,s.forEach=function(t,n,r){return f(u.forEach(t,n,r))},s.repeat=function(t,n,r){return f(u.repeat(t,n,r))},s.until=function(t,n){return f(u.until(t,n))};const te=13;s.waitUntil=function(t,n){return f(u.until(t,n),te)},s.forOf=function(t,n,r){return f(u.forOf(t,n,r))},s.StopIteration=ee,s.iterate=f,s.iterator=u,s.isThenable=Q,s.isArrayLike=V,s.nextTick=Z;const{RelationshipStore:I,UserStore:ne,GuildStore:S,modals:{actions:{show:le},ModalRoot:ce}}=L.default;function re(){Array.isArray(c.persist.ghost.unfriends)||(c.persist.store.unfriends=[]),g.add((()=>{let e=0,t=new Set(I.getFriendIDs());async function n(){if(e)return;let r=new Set(I.getFriendIDs());await s.forEach([...t.values()],a=>{if(r.has(a))return;let i=ne.getUser(a);c.persist.store.unfriends.unshift({at:Date.now(),tag:i.tag,id:i.id,avatar:i.avatar}),v.toasts.show.info(`You are no longer friends with "${i.tag}"!`)}),t=r,await k.sleep(1e4),n()}return n(),()=>{e=1}})())}function ie(){Array.isArray(c.persist.ghost.leavedGuilds)||(c.persist.store.leavedGuilds=[]),g.add((()=>{let e=0,t=S.getGuilds();async function n(){if(e)return;let r=S.getGuilds();await s.forEach(Object.keys(t),a=>{if(r[a])return;let i=t[a];c.persist.store.leavedGuilds.push({at:Date.now(),name:i.name,id:i.id,icon:i.icon}),v.toasts.show.info(`You are laved from "${i.name}"!`)}),t=r,await k.sleep(1e4),n()}return n(),()=>{e=1}})())}var ae={load(){re(),ie()},unload(){g.removeAll()}};return ae})(acord.modules.common,acord.extension,acord.utils,acord.ui);
