(function(q,V,W,H,J,s,I,j,X){"use strict";function b(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function K(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(r){if(r!=="default"){var a=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,a.get?a:{enumerable:!0,get:function(){return e[r]}})}}),t.default=e,Object.freeze(t)}var i=K(q),L=b(V),O=b(W),Q=b(H),Z=b(J);class ee{constructor(){this.patches=[]}add(...t){this.patches.push(...t)}remove(t){let[r]=this.patches.splice(this.patches.indexOf(a=>a==t),1);r()}removeAll(){let t=this.patches.splice(0,this.patches.length);for(let r=0;r<t.length;r++)t[r]()}}var g=new ee;function te({className:e=""}={}){return`
        <svg
            viewBox="0 0 24 24" 
            width="24" 
            height="24"
            class="uagll--icon uagll--dislike-icon ${e}"
        >
            <path fill="currentColor" d="M2.808 1.393l18.384 18.385-1.414 1.414-3.747-3.747L12 21.485 3.52 12.993c-2.04-2.284-2.028-5.753.034-8.023L1.393 2.808l1.415-1.415zm17.435 3.364c2.262 2.268 2.34 5.88.236 8.236l-1.635 1.636L7.26 3.046c1.67-.207 3.408.288 4.741 1.483 2.349-2.109 5.979-2.039 8.242.228z"/>
        </svg>
    `}const{RelationshipStore:G,UserStore:d,GuildStore:U,modals:{actions:{show:re},ModalRoot:ae},components:{Button:f}}=Q.default,_={DANGER:"#eb3d47",SECONDARY:"#8a8e93",SUCCESS:"#3aa360",PRIMARY:"#5865f2"};function S(e={}){return i.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:"uagll--icon uagll--close-icon",style:{color:e.color}},i.createElement("path",{d:"M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z",fill:"currentColor"}))}var E=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},$={},D={},C={};Object.defineProperty(C,"__esModule",{value:!0}),C.default=Object.freeze({GET:"GET",SET:"SET",DELETE:"DELETE",UPDATE:"UPDATE"});var se=E&&E.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(D,"__esModule",{value:!0});const A=Z.default,m=se(C);function ie(e,t=!1,r=()=>!0){(0,A.useRef)(e.ghost);const[,a]=(0,A.useReducer)(l=>~l,0);return(0,A.useEffect)(()=>{function l(n,o){r(n,o)&&a()}return e.on(m.default.UPDATE,l),t||(e.on(m.default.SET,l),e.on(m.default.DELETE,l)),()=>{e.off(m.default.UPDATE,l),t||(e.off(m.default.SET,l),e.off(m.default.DELETE,l))}},[]),e.ghost}D.default=ie,function(e){var t=E&&E.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(e,"__esModule",{value:!0}),e.useNest=void 0;var r=D;Object.defineProperty(e,"useNest",{enumerable:!0,get:function(){return t(r).default}})}($);const le=O.default.findByProps("thin","scrollerBase");function ne({e}){$.useNest(s.persist);let t=d.getCurrentUser().id;return Array.isArray(s.persist.ghost.users?.[t]?.unfriends)||(s.persist.ghost.users[t].unfriends=[]),Array.isArray(s.persist.ghost.users?.[t]?.leavedGuilds)||(s.persist.ghost.users[t].leavedGuilds=[]),i.createElement(ae,{transitionState:e.transitionState,size:"large",className:"uagll--modal-root"},i.createElement("div",{className:"uagll--modal-header"},i.createElement("h1",{className:"uagll--modal-title"},s.i18n.format("TITLE")),i.createElement("div",{className:"uagll--modal-close",onClick:e.onClose},i.createElement(S,{color:_.SECONDARY}))),i.createElement("div",{className:`uagll--modal-body ${le.thin}`},i.createElement("section",null,i.createElement("div",{className:"section-title"},i.createElement("h1",{class:"header"},s.i18n.format("UNFRIENDS")),i.createElement(f,{size:f.Sizes.TINY,color:f.Colors.TRANSPARENT,onClick:()=>{s.persist.store.users[t].unfriends=[]}},s.i18n.format("CLEAR"))),i.createElement("div",{className:"section-content"},(s.persist.ghost.users?.[t]?.unfriends||[]).map((r,a)=>i.createElement("div",{className:"item"},i.createElement("div",{className:"left",style:{backgroundImage:`url('https://cdn.discordapp.com/avatars/${r.id}/${r.avatar}.png?size=256')`}}),i.createElement("div",{className:"right"},i.createElement("div",{className:"top"},i.createElement("div",{className:"left"},i.createElement("span",null,r.tag.split("#")[0]),i.createElement("span",{className:"discriminator"},"#",r.tag.split("#")[1])),i.createElement("div",{className:"right",onClick:()=>{s.persist.store.users[t].unfriends.splice(s.persist.store.users[t].unfriends.findIndex(l=>l._id==r._id),1),s.persist.store.users[t].unfriends=s.persist.store.users[t].unfriends}},i.createElement(S,{color:_.SECONDARY}))),i.createElement("div",{className:"bottom"},i.createElement("div",{className:"left"},r.id),i.createElement("div",{className:"right"},new Date(r.at).toLocaleDateString()," ",new Date(r.at).toLocaleTimeString()))))))),i.createElement("section",null,i.createElement("div",{className:"section-title"},i.createElement("h1",{class:"header"},s.i18n.format("GUILD_LEAVES")),i.createElement(f,{size:f.Sizes.TINY,color:f.Colors.TRANSPARENT,onClick:()=>{s.persist.store.users[t].leavedGuilds=[]}},s.i18n.format("CLEAR"))),i.createElement("div",{className:"section-content"},(s.persist.ghost.users?.[t]?.leavedGuilds||[]).map((r,a)=>i.createElement("div",{className:"item"},i.createElement("div",{className:"left",style:{backgroundImage:`url('https://cdn.discordapp.com/icons/${r.id}/${r.icon}.png?size=256')`}}),i.createElement("div",{className:"right"},i.createElement("div",{className:"top"},i.createElement("div",{className:"left"},r.name),i.createElement("div",{className:"right",onClick:()=>{s.persist.store.users[t].leavedGuilds.splice(s.persist.store.users[t].leavedGuilds.findIndex(l=>l._id==r._id),1),s.persist.store.users[t].leavedGuilds=s.persist.store.users[t].leavedGuilds}},i.createElement(S,{color:_.SECONDARY}))),i.createElement("div",{className:"bottom"},i.createElement("div",{className:"left"},r.id),i.createElement("div",{className:"right"},new Date(r.at).toLocaleDateString()," ",new Date(r.at).toLocaleTimeString())))))))))}const k=O.default.findByProps("toolbar","transparent","hamburger");function oe(){g.add(L.default.patch(`section .${k.toolbar}`,e=>{if(e.childElementCount!=3)return;let t=L.default.parseHTML(`
                    <div class="${k.iconWrapper} ${k.clickable}" acord--tooltip-content="${s.i18n.format("TITLE")}" acord--tooltip-side="left">
                        ${te({className:k.icon})}
                    </div>
                `);t.onclick=()=>{re(r=>i.createElement(ne,{e:r}))},e.insertBefore(t,e.lastElementChild)}))}var c={},y={},v={};v.isThenable=function(t){return t!=null&&typeof t.then=="function"},v.isArrayLike=function(t){return t!=null&&typeof t.length=="number"&&t.length>=0};const{isArrayLike:ce}=v;y.forEach=function(e,t,r){let a=0,l;if(ce(e))return l=e.length,{next(){if(a>=l)return[!0,null];const o=t.call(r,e[a],a,e);return a++,[!1,o]}};const n=Object.keys(e);return l=n.length,{next(){if(a>=l)return[!0,null];const o=n[a++],w=t.call(r,e[o],o,e);return[!1,w]}}},y.repeat=function(e,t,r){let a,l,n;return e&&typeof e=="object"?(a=e.start||0,l=e.step||1,n=e.done):(a=0,l=1,n=e),{next(){const o=t.call(r,a);return a+=l,a>=n?[!0,o]:[!1,o]}}},y.until=function(e,t){return{next(){const r=e.call(t);return[!1,r]}}},y.forOf=function(e,t,r){const a=e[Symbol.iterator]();return{next(){const l=a.next();if(l.done)return[!0,null];const n=t.call(r,l.value,e);return[!1,n]}}};var x={},R=(()=>{if(typeof setImmediate=="function")return e=>{setImmediate(e)};if(typeof process=="object"&&typeof process.nextTick=="function")return e=>{process.nextTick(e)};if(typeof MessageChannel=="function"){const e=new MessageChannel;let t={},r=t;return e.port1.onmessage=()=>{t=t.next;const a=t.task;delete t.task,a()},a=>{r=r.next={task:a},e.port2.postMessage(0)}}return e=>{setTimeout(e,0)}})();const{isThenable:ue}=v,M=x,z=R,P=1500;var de=function(t,r=0){return new Promise((a,l)=>{let n=0;function o(){const w=Date.now();let T;try{for(;;){const[u,N]=t.next();if(ue(N)){N.then(B=>{u?a(B):B===M?a():o()},l);return}if(u){a(N);return}if(N===M){a();return}if(r>0||(T=Date.now()-w,n+=T,n>1e3))break;if(!(T<10))break}}catch(u){l(u);return}if(r>0){const u=Math.min(P,Date.now()-w+r);setTimeout(o,u)}else{const u=Math.min(P,T/3);n=0,u>10?setTimeout(o,u):z(o)}}z(o)})},fe="chillout",me="Reduce CPU usage by non-blocking async loop and psychologically speed up in JavaScript",pe="5.0.0",he="polygon planet <polygon.planet.aqua@gmail.com>",ge={url:"https://github.com/polygonplanet/chillout/issues"},ye={"@babel/core":"^7.8.3","@babel/preset-env":"^7.8.3",babelify:"^10.0.0",bannerify:"^1.0.1",browserify:"^16.5.0","es6-shim":"^0.35.5",eslint:"^6.8.0",karma:"^4.4.1","karma-browserify":"^6.1.0","karma-chrome-launcher":"^3.1.0","karma-detect-browsers":"^2.3.3","karma-es6-shim":"^1.0.0","karma-firefox-launcher":"^1.3.0","karma-ie-launcher":"^1.0.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","karma-safari-launcher":"^1.0.0",mocha:"^7.0.0","package-json-versionify":"^1.0.4",pidusage:"1.0.2","power-assert":"^1.6.1","uglify-js":"^3.7.5",uglifyify:"^5.0.2",watchify:"^3.11.1"},ve={node:">=8.10.0"},be=["dist/*","src/*"],Ee="https://github.com/polygonplanet/chillout",ke=["acceleration","async await","asynchronous","cpu use rate","cpu utilization rate","heavy processing","iterate","iteration","lightweight","nextTick","non-blocking","optimization","optimize for loop","performance","promise","reduce cpu usage","setimmediate","waitUntil"],we="MIT",Te="src/index.js",Ne={type:"git",url:"https://github.com/polygonplanet/chillout.git"},_e={benchmark:"node benchmark/benchmark",build:"npm run compile && npm run minify",compile:"browserify src/index.js -o dist/chillout.js -s chillout -p [ bannerify --file src/banner.js ] --no-bundle-external --bare",minify:"uglifyjs dist/chillout.js -o dist/chillout.min.js --comments -c -m -b ascii_only=true,beautify=false",test:"./node_modules/.bin/eslint . && npm run build && mocha test/**/*.spec.js --timeout 10000 && karma start karma.conf.js",travis:"npm run build && mocha test/**/*.spec.js --timeout 10000 && karma start karma.conf.js --single-run",watch:"watchify src/index.js -o dist/chillout.js -s chillout -p [ bannerify --file src/banner.js ] --no-bundle-external --bare --poll=200 -v"},Se={transform:["babelify","package-json-versionify"]},De={name:fe,description:me,version:pe,author:he,bugs:ge,devDependencies:ye,engines:ve,files:be,homepage:Ee,keywords:ke,license:we,main:Te,repository:Ne,scripts:_e,browserify:Se};const p=y,h=de,{isThenable:Ce,isArrayLike:Ae}=v,Ie=R,je=x;c.version=De.version,c.forEach=function(t,r,a){return h(p.forEach(t,r,a))},c.repeat=function(t,r,a){return h(p.repeat(t,r,a))},c.until=function(t,r){return h(p.until(t,r))};const Le=13;c.waitUntil=function(t,r){return h(p.until(t,r),Le)},c.forOf=function(t,r,a){return h(p.forOf(t,r,a))},c.StopIteration=je,c.iterate=h,c.iterator=p,c.isThenable=Ce,c.isArrayLike=Ae,c.nextTick=Ie;let F=null;function Oe(){g.add((()=>{let e=d.getCurrentUser().id,t=0,r=[];async function a(){if(e=d.getCurrentUser().id,s.persist.ghost.users?.[e]?.lastFriends||(s.persist.store.users[e].lastFriends=[],s.persist.store.users[e].unfriends=[]),F!=e&&(r=new Set(s.persist.ghost.users?.[e]?.lastFriends?.length?s.persist.ghost.users[e].lastFriends:G.getFriendIDs())),F=e,t)return;let l=new Set(G.getFriendIDs());await c.forEach([...r.values()],n=>{if(l.has(n))return;let o=d.getUser(n);!o||(s.persist.store.users[e].unfriends.unshift({at:Date.now(),tag:o.tag,id:o.id,avatar:o.avatar,_id:Math.random().toString(36).replace(".","")}),j.notifications.show(s.i18n.format("UNFRIEND",o.tag)))}),r=l,s.persist.store.users[e].lastFriends=[...l.values()],await I.sleep(1e4),a()}return a(),()=>{t=1}})())}let Y=null;function Ge(){g.add((()=>{let e=d.getCurrentUser().id,t=0,r={};async function a(){if(e=d.getCurrentUser().id,s.persist.ghost.users?.[e]?.lastGuilds||(s.persist.store.users[e].lastGuilds={},s.persist.store.users[e].leavedGuilds=[]),Y!=e&&(r=s.persist.ghost.users?.[e]?.lastGuilds?s.persist.ghost.users[e].lastGuilds||{}:U.getGuilds()),Y=e,t)return;let l=U.getGuilds();await c.forEach(Object.keys(r),n=>{if(l[n])return;let o=r[n];s.persist.store.users[e].leavedGuilds.unshift({at:Date.now(),name:o.name,id:o.id,icon:o.icon,_id:Math.random().toString(36).replace(".","")}),j.notifications.show(s.i18n.format("GUILD_LEAVE",o.name))}),r=l,s.persist.store.users[e].lastGuilds=Object.fromEntries(Object.entries(l).map(n=>[n.id,{name:n.name,id:n.id,icon:n.icon}]).filter(n=>n.id)),await I.sleep(1e4),a()}return a(),()=>{t=1}})())}var Ue=()=>X.injectCSS(".uagll--modal-root{display:flex;flex-direction:column;padding:16px}.uagll--modal-header{margin-bottom:16px;display:flex;align-items:center;justify-content:space-between}.uagll--modal-title{font-size:28px;color:#efefef;font-weight:600}.uagll--modal-close{width:24px;height:24px;cursor:pointer}.uagll--modal-close svg{width:24px;height:24px}.uagll--modal-body{display:flex;flex-direction:column;height:550px;overflow:auto;contain:content}.uagll--modal-body section{margin-top:16px;margin-bottom:8px}.uagll--modal-body .section-title{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}.uagll--modal-body .section-content .item{display:flex;gap:8px;padding:8px;background-color:#0000001a;border-radius:4px;margin-bottom:8px}.uagll--modal-body .section-content .item>.left{height:48px;width:48px;border-radius:4px;background-position:center;background-size:cover}.uagll--modal-body .section-content .item>.right{display:flex;flex-direction:column;width:100%}.uagll--modal-body .section-content .item>.right>.top{display:flex;justify-content:space-between}.uagll--modal-body .section-content .item>.right>.top>.left{display:flex;color:#fafafa;font-size:28px;font-weight:500;align-items:flex-end;user-select:text}.uagll--modal-body .section-content .item>.right>.top>.left .discriminator{font-size:20px;opacity:.5}.uagll--modal-body .section-content .item>.right>.top>.right{cursor:pointer}.uagll--modal-body .section-content .item>.right>.top>.right svg{width:16px;height:16px}.uagll--modal-body .section-content .item>.right>.bottom{display:flex;flex-direction:column;color:#efefef;opacity:.75;font-size:10px;margin-top:2px;user-select:text}.uagll--modal-body .header{font-size:22px;font-weight:600;color:#efefef}");function $e(){g.add(Ue())}var xe={load(){Oe(),Ge(),$e(),oe(),Array.isArray(s.persist.ghost.unfriends)&&(delete s.persist.store.unfriends,delete s.persist.store.lastFriends,delete s.persist.ghost.lastGuilds,delete s.persist.ghost.leavedGuilds)},unload(){g.removeAll()}};return xe})(acord.modules.common.React,acord.dom,acord.modules.webpack,acord.modules.common,acord.modules.common.React,acord.extension,acord.utils,acord.ui,acord.patcher);
